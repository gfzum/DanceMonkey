# 技术架构文档

## 系统概述

DanceMonkey采用前后端分离的现代化云原生架构，基于Azure云服务构建。系统主要由以下几个核心部分组成：

1. 前端应用（React + TypeScript）
2. 后端服务（FastAPI）
3. 数据存储（PostgreSQL + Azure Blob Storage）
4. AI服务（Azure Machine Learning）
5. 监控服务（Application Insights）

## 详细架构

### 1. 前端应用

#### React应用
- **技术栈**：
  - React + TypeScript
  - Vite 构建工具
  - TailwindCSS 样式框架
  - React Query 数据管理
- **功能**：
  - 视频上传和预览
  - 处理进度展示
  - 结果可视化
  - 实时状态更新
- **特点**：
  - 组件化开发
  - 类型安全
  - 响应式设计
  - 优秀的用户体验

### 2. 后端服务

#### FastAPI应用
- **角色**：提供RESTful API服务
- **功能**：
  - 处理HTTP请求
  - 管理异步任务
  - 协调各服务组件
  - 提供实时状态更新
- **技术特点**：
  - 异步处理能力
  - OpenAPI文档自动生成
  - 依赖注入系统
  - 内置验证功能

#### 异步处理
- 使用FastAPI的后台任务功能处理长时间运行的操作
- 实现任务状态追踪和进度报告
- 支持任务取消和错误处理

### 3. 数据存储层

#### PostgreSQL数据库
- **用途**：
  - 存储用户数据
  - 记录处理任务状态
  - 保存分析结果
- **数据模型**：
  - 用户信息
  - 视频元数据
  - 处理任务记录
  - 分析结果数据

#### Azure Blob Storage
- **用途**：存储视频文件和生成的资源
- **容器结构**：
  - `videos`：原始视频文件
  - `processed`：处理后的视频
  - `exports`：导出的编舞方案

### 4. AI服务层

#### Azure Machine Learning
- **功能**：
  - 舞蹈动作识别
  - 动作序列分析
  - 编舞生成
- **部署模式**：
  - 在线推理端点
  - 批量处理作业

### 5. 监控层

#### Application Insights
- **监控指标**：
  - API性能指标
  - 错误追踪
  - 用户行为分析
  - 资源使用情况
- **告警配置**：
  - 性能阈值告警
  - 错误率告警
  - 资源使用告警

## 安全架构

### 身份认证
- Azure AD集成
- JWT令牌认证
- API密钥认证（用于服务间通信）

### 授权控制
- 基于角色的访问控制（RBAC）
- 资源级别权限管理
- 最小权限原则

### 数据安全
- 传输加密（TLS 1.3）
- 存储加密
- 敏感数据脱敏

## 扩展性设计

### 水平扩展
- 前端应用支持多实例部署
- 后端服务支持多实例部署
- 数据库读写分离
- 负载均衡配置

### 垂直扩展
- 资源自动伸缩
- 性能等级调整
- 存储容量动态扩展

## 部署架构

### 生产环境
- Azure Static Web Apps托管前端应用
- Azure App Service托管后端服务
- Azure Database for PostgreSQL
- Azure Blob Storage
- Azure Machine Learning服务
- Application Insights监控

### 开发环境
- Vite开发服务器（前端）
- FastAPI开发服务器（后端）
- 本地PostgreSQL
- Azure存储模拟器
- 本地ML模型

## 系统限制

### 技术限制
- 视频文件大小限制：500MB
- 处理时间：单个视频最长30分钟
- 并发处理任务数：基于资源配置动态调整

### 性能指标
- API响应时间：< 200ms（95%请求）
- 视频处理时间：视频长度的1.5倍以内
- 系统可用性：99.9%

## 未来扩展

### 计划功能
1. 实时视频分析
2. 多人舞蹈协同
3. VR/AR集成
4. 社交功能集成

### 技术演进
1. 引入边缘计算
2. 增强AI模型能力
3. 支持更多视频格式
4. 优化存储架构